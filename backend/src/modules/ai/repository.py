import datetime
from typing import Literal

from ollama import AsyncClient

from src.config import settings
from src.logging_ import logger
from src.pydantic_base import BaseSchema
from src.storages.mongo.events import Disciplines, EventLocation

SYSTEM_PROMPT = """
–¢—ã –ø–æ–º–æ—â–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–ø–∏—Å–∞–Ω–∏–π —Å–æ–±—ã—Ç–∏–π –≤ –ø–æ—Å—Ç–∞—Ö Telegram. –í–æ–∑–≤—Ä–∞—â–∞–π –¥–∞–Ω–Ω—ã–µ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ JSON.
–ü—Ä–∏–º–µ—Ä—ã:

---

üèÜ¬´OrenHack-2024¬ª: —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –≤ –û—Ä–µ–Ω–±—É—Ä–≥–µ —É–∂–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–∏!

–í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é ¬´OrenHack-2024¬ª –ø—Ä–æ–π–¥—É—Ç 27 –∏ 28 –Ω–æ—è–±—Ä—è –≤ –≥. –û—Ä–µ–Ω–±—É—Ä–≥–µ –≤ –î–ö–∏–° ¬´–ì–∞–∑–æ–≤–∏–∫¬ª. 24 –∫–æ–º–∞–Ω–¥—ã –∏–∑ 16 —Ä–µ–≥–∏–æ–Ω–æ–≤ —Å–æ–π–¥—É—Ç—Å—è –≤ —Ç—É—Ä–Ω–∏—Ä–µ –≤ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ ¬´–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏¬ª.

–¢–∞–∫–∂–µ –≤ —Ä–∞–º–∫–∞—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π –ø—Ä–æ–π–¥—É—Ç:
‚ö™Ô∏è–ø–∞–Ω–µ–ª—å–Ω–∞—è —Å–µ—Å—Å–∏—è ¬´–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. –í—ã–∑–æ–≤—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –º–∏—Ä–∞¬ª
‚ö™Ô∏è–æ—Ç–∫—Ä—ã—Ç—ã–π —É—Ä–æ–∫ —Ü–∏—Ñ—Ä—ã –æ—Ç –í–ö
‚ö™Ô∏è–≤—ã—Å—Ç–∞–≤–∫–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ ¬´–ú–æ—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è –≤ IT¬ª
‚ö™Ô∏è–∫–∏–±–µ—Ä—É—á–µ–Ω–∏—è –ø–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—é, —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –∞—Ç–∞–∫
‚ö™Ô∏è–∫—Ä—É–≥–ª—ã–π —Å—Ç–æ–ª –Ω–∞ —Ç–µ–º—É ¬´–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ —É—Å–ª–æ–≤–∏—è—Ö —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏¬ª

‚ö™Ô∏è –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –∫ –ø—Ä—è–º–æ–π —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ (https://vk.com/wall-219133976_394), (https://vk.com/wall-219133976_394) —á—Ç–æ–±—ã –Ω–µ —É–ø—É—Å—Ç–∏—Ç—å —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ!

–û—Ç–≤–µ—Ç:
{
  "status": "ok",
  "data": {
    "title": "OrenHack-2024",
    "discipline": ["–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"],
    "start_date": "2024-11-27T00:00:00",
    "end_date": "2024-11-28T00:00:00",
    "location": {
        "country": "–†–æ—Å—Å–∏—è",
        "region": "–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "city": "–≥. –û—Ä–µ–Ω–±—É—Ä–≥, –î–ö–∏–° ¬´–ì–∞–∑–æ–≤–∏–∫¬ª"
    }
  }
}

---

üîî  –û—Ç–º–µ—á–∞–µ–º –í—Å–µ–º–∏—Ä–Ω—ã–π –¥–µ–Ω—å –º–æ–ª–æ–¥–µ–∂–∏ –Ω–∞ foncode.ru ‚Äî –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ "—Ä–µ–≥—É–ª—è—Ä–Ω—ã–º —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º #15" –Ω–∞ foncode.ru!

üñ• –ü–µ—Ä–µ—Ö–æ–¥–∏ –≤ —Ä–∞–∑–¥–µ–ª —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–º—É –≤—ã–∑–æ–≤—É –≤–º–µ—Å—Ç–µ —Å –Ω–∞–º–∏!

üîñ10 –Ω–æ—è–±—Ä—è 12.00 (–º—Å–∫) —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è #15 (https://foncode.ru/news/99) –≤ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ ¬´–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–µ¬ª.


‚ÑπÔ∏è–ù–∞–ø–æ–º–Ω–∏–º, –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –º–æ–∂–µ—Ç –ª—é–±–æ–π –∂–µ–ª–∞—é—â–∏–π, –∫–æ—Ç–æ—Ä—ã–π –≥–æ—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ —Å–∏–ª—ã –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ ‚Äî –ø—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 50 000 —Ä—É–±–ª–µ–π, –∞ 5 —Å—á–∞—Å—Ç–ª–∏–≤—á–∏–∫–æ–≤, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, –ø–æ–ª—É—á–∞—Ç –ø—Ä–∏–∑ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–π 3 000 —Ä—É–±–ª–µ–π.

* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞ 10 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è.

#–§–°–ü #–§–æ–Ω–∫–æ–¥ #Foncode

–û—Ç–≤–µ—Ç:
{
    "status": "ok",
    "data": {
        "title": "–†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è #15 FONCODE",
        "discipline": ["–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–µ"],
        "start_date": "2024-11-10T12:00:00",
        "end_date": "2024-11-10T12:00:00",
        "location": null
    }
}
---

üåç –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø–æ –ò–ò –∏ –¥–∏–∑–∞–π–Ω-–º—ã—à–ª–µ–Ω–∏—é

–ü—Ä–∏–≥–ª–∞—à–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –∏ —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –æ—Ç 12 –ª–µ—Ç –ø—Ä–æ—è–≤–∏—Ç—å —Å–µ–±—è –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è—Ö –≤ –¥–≤—É—Ö –Ω–æ–≤—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö ‚Äî –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∏ –¥–∏–∑–∞–π–Ω-–º—ã—à–ª–µ–Ω–∏—é –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ! –≠—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –Ω–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∞—Ä–µ–Ω–µ –∏ –ø–æ–æ–±—â–∞—Ç—å—Å—è —Å –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏ —Å–æ –≤—Å–µ–≥–æ –º–∏—Ä–∞.

‚û°Ô∏è  –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø—Ä–æ–π–¥—É—Ç 6-8 –¥–µ–∫–∞–±—Ä—è –≤ –æ–Ω–ª–∞–π–Ω —Ñ–æ—Ä–º–∞—Ç–µ

‚û°Ô∏è –ß—Ç–æ –∂–¥–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤?

‚ö™Ô∏è –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–¥–æ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –∏ –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞–≤—ã–∫–∏ –≤ –æ–±–ª–∞—Å—Ç—è—Ö –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è.

‚ö™Ô∏è –î–∏–∑–∞–π–Ω-–º—ã—à–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Å–º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—é –¥–∏–∑–∞–π–Ω-–º—ã—à–ª–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç –º–∏—Ä, –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –∏–Ω–∂–µ–Ω–µ—Ä–∞–º –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞—à–∏ –∏–¥–µ–∏.

‚û°Ô∏è –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã:
‚ö™Ô∏è12-14 –ª–µ—Ç
‚ö™Ô∏è15-18 –ª–µ—Ç
‚ö™Ô∏è16+ –ª–µ—Ç (—Å—Ç—É–¥–µ–Ω—Ç—ã –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã)

–£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏, –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ –¥–æ–º–∞! –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –¥–æ 4 –¥–µ–∫–∞–±—Ä—è –Ω–∞ —Å–∞–π—Ç–µ. (http://events.fsp-russia.com/opencup)

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤—ã –≥–æ—Ç–æ–≤—ã –∫ –≤—ã–∑–æ–≤–∞–º –º–∏—Ä–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—èüî•

–û—Ç–≤–µ—Ç:
{
  "status": "ok",
  "data": {
    "title": "–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –ø–æ –ò–ò –∏ –¥–∏–∑–∞–π–Ω-–º—ã—à–ª–µ–Ω–∏—é",
    "discipline": ["–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "–¥–∏–∑–∞–π–Ω-–º—ã—à–ª–µ–Ω–∏–µ"],
    "start_date": "2024-12-06T00:00:00",
    "end_date": "2024-12-08T00:00:00",
    "location": null
  }
}

---

–§–û–ù–ö–û–î 2024 ‚Äì –æ–±—â–∏–π –ø—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥ 1.000.000 —Ä—É–±–ª–µ–π!
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –æ—Ç–±–æ—Ä–æ—á–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –£–ñ–ï –Ω–∞—á–∞–ª–∞—Å—å!

–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Å–ø–æ—Ä—Ç–∞ –≥. –ú–æ—Å–∫–≤—ã, –ú–æ—Å–∫–æ–º—Å–ø–æ—Ä—Ç, –§–µ–¥–µ—Ä–∞—Ü–∏—è —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ú–æ—Å–∫–≤—ã –ø—Ä–æ–≤–æ–¥—è—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä ¬´–§–æ–Ω–∫–æ–¥¬ª –∫–æ—Ç–æ—Ä—ã–π –≤ 2024 –≥–æ–¥—É –ø—Ä–æ–π–¥–µ—Ç –≤ 2 —ç—Ç–∞–ø–∞.

–û—Ç–±–æ—Ä–æ—á–Ω—ã–π —Ç—É—Ä –ø—Ä–æ–π–¥–µ—Ç 15 –¥–µ–∫–∞–±—Ä—è ‚Äì —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫–æ–Ω—Ç–µ—Å—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º ¬´–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–≥–æ¬ª. 128 –ª—É—á—à–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –ø—Ä–æ–π–¥—É—Ç –≤ —Ñ–∏–Ω–∞–ª –∏ –ø–æ–ª—É—á–∞—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–±–æ—Ä–æ—Ç—å—Å—è –∑–∞ –∑–≤–∞–Ω–∏–µ —Å–∏–ª—å–Ω–µ–π—à–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –†–æ—Å—Å–∏–∏!

–û—Ç–±–æ—Ä–æ—á–Ω–æ–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ—Ç –æ–Ω–ª–∞–π–Ω, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ.
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π ‚Äì https://foncode.ru

–§–∏–Ω–∞–ª —Å–æ—Å—Ç–æ–∏—Ç—Å—è 22 –¥–µ–∫–∞–±—Ä—è –≤ –ú–æ—Å–∫–≤–µ, –≤ VK Play –ê—Ä–µ–Ω–∞
(–ú–æ—Å–∫–≤–∞, –î–º–∏—Ç—Ä–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, –¥.27 –∫.1)

–¢—É—Ä–Ω–∏—Ä –ø–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é ¬´–§–û–ù–ö–û–î 2024¬ª —Å—Ç–∞–Ω–µ—Ç –æ–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö –∑–Ω–∞—á–∏–º—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–æ–ª–æ–¥–µ–∂–∏ –≤ –†–æ—Å—Å–∏–∏, —Å –æ–±—â–∏–º –ø—Ä–∏–∑–æ–≤—ã–º —Ñ–æ–Ω–¥–æ–º –≤ 1 000 000 —Ä—É–±–ª–µ–π! –ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —Å–∞–º—ã–π –º–∞—Å—à—Ç–∞–±–Ω—ã–π –¢–£–†–ù–ò–† 2024 –≥–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–π —Å–≤–æ–π —à–∞–Ω—Å –ø–æ–±–æ—Ä–æ—Ç—å—Å—è –∑–∞ –ø—Ä–∏–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞!

–û—Ç–≤–µ—Ç:
{
  "status": "ok",
  "data": {
    "title": "–§–û–ù–ö–û–î 2024",
    "discipline": ["–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–µ"],
    "start_date": "2024-12-15T00:00:00",
    "end_date": "2024-12-22T00:00:00",
    "location": {
        "country": "–†–æ—Å—Å–∏—è",
        "region": "–≥. –ú–æ—Å–∫–≤–∞",
        "city": "–≥. –ú–æ—Å–∫–≤–∞, VK Play –ê—Ä–µ–Ω–∞"
    }
  }
}
"""


class _Event(BaseSchema):
    title: str
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"
    discipline: list[Disciplines]
    "–ù–∞–∑–≤–∞–Ω–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω"
    start_date: datetime.datetime
    "–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞"
    end_date: datetime.datetime
    "–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞"
    location: EventLocation
    "–ú–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è"


class Output(BaseSchema):
    """
    –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–±—ã—Ç–∏–∏, —Ç–æ data –î–û–õ–ñ–ù–ê –ë–´–¢–¨ None, –∞ status - ok
    """

    status: Literal["ok", "error"]
    "–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞"
    message: str | None = None
    "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"
    data: _Event | None = None
    "–î–∞–Ω–Ω—ã–µ"


class AIRepository:
    def __init__(self):
        self.ollama_client = AsyncClient(host=settings.ai.ollama_host)

    async def get_event_from_text(self, text: str) -> tuple[_Event | None, str]:
        human_current_time = datetime.datetime.now(datetime.UTC).strftime("%Y-%m-%d")

        text = f"{text}\n–°–µ–≥–æ–¥–Ω—è: {human_current_time}"

        # JSON Schema –¥–ª—è —Å–æ–±—ã—Ç–∏—è
        schema = Output.model_json_schema()

        # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Ollama
        response = await self.ollama_client.chat(
            model="rscr/ruadapt_qwen2.5_32b:Q2_K_M",
            messages=[
                {"role": "system", "content": SYSTEM_PROMPT},
                {
                    "role": "user",
                    "content": text,
                },
            ],
            format=schema,
            stream=False,
        )

        logger.info(f"AI response: {response}")

        output = Output.model_validate_json(response.message.content)

        if output.status == "error":
            return None, output.message
        elif output.status == "ok":
            return output.data, ""
        else:
            raise ValueError(f"Unknown status: {output.status}")


if settings.ai:
    ai_repository: AIRepository = AIRepository()
else:
    import warnings

    warnings.warn("AI settings are not configured, AIRepository will not be available", RuntimeWarning)
    ai_repository: None = None
